
# Архитектура парсера Salesforce запросов

## Обзор
Парсер предназначен для извлечения структурированной информации из слабо структурированных запросов Salesforce. Данные содержат метаинформацию и нумерованный список с пропусками и должны возвращать унифицированный объект с предсказательной уверенностью в значениях.

## Основные требования
- Обработка метаинформации (CV строка, URL)
- Обработка слова-разделителя "Описание"
- Парсинг нумерованного списка пунктов (1-31) с преобразованием отсутствующих в единый маркер `N/A`
- Поддержка множественных языков для пунктов 10-11
- Обработка геоограничений и флагов доступа
- Механизм confidence для качества распознавания
- Возможность расширения для новых полей и стратегий

## Структура проекта
```
nlp-parser/src/
├── core/                    # Ядро системы
│   ├── parser-engine.ts     # Главный движок парсера
│   ├── strategy-manager.ts  # Менеджер стратегий парсинга
│   ├── confidence-evaluator.ts # Оценка confidence полей
│   └── field-normalizer.ts  # Нормализация и приведение полей
├── strategies/              # Стратегии парсинга
│   ├── regex-strategy.ts    # Обработка шаблонов и регулярных выражений
│   ├── nlp-strategy.ts      # NLP на основе языковых моделей
│   ├── hybrid-strategy.ts   # Смешанная стратегия (regex + NLP)
│   ├── structured-list-strategy.ts  # Специализированный парсер нумерованных списков
│   └── meta-parsing-strategy.ts     # Парсинг метаинформации
├── extractors/              # Извлечение полей
│   ├── meta-info-extractor.ts      # CV строка и URL
│   ├── numbered-list-extractor.ts  # Планы из нумерованного списка
│   ├── multi-language-extractor.ts # Обработка множества языков
│   ├── geo-restrictions-extractor.ts # Геоограничения и доступность
│   └── missing-data-handler.ts     # Обработка отсутствующих данных (N/A)
├── processors/              # Предобработка текста
│   ├── text-normalizer.ts   # Очистка и нормализация текста
│   ├── section-splitter.ts  # Разбивка текста на логические части
│   └── pattern-matcher.ts   # Поиск паттернов
├── validators/              # Проверка и валидация
│   ├── field-validator.ts   # Проверка корректности значений
│   └── consistency-validator.ts # Логическая согласованность
└── utils/                   # Утилиты и вспомогательные функции
    ├── text-utils.ts
    ├── date-utils.ts
    └── mapping-utils.ts
```

## Поток обработки
1. Получение сырых данных из Salesforce
2. Предобработка и нормализация текста
3. Выделение метаинформации
4. Разделение на секции
5. Применение соответствующих стратегий парсинга
6. Извлечение и нормализация полей
7. Оценка confidence и валидация
8. Формирование единого результата с установкой дефолтных значений `N/A` при отсутствии данных

## Confidence система
- Значения confidence в интервале 0.0-1.0 для каждого поля
- Критерии confidence опираются на качество совпадения (regex, NLP и комбинированные)
- Итоговая уверенность - агрегат средневзвешенного по важности полей

## Расширяемость
- Добавление новых стратегий и экстракторов без изменений в ядре
- Конфигурация для разных клиентов с возможностью настройки парсинга

